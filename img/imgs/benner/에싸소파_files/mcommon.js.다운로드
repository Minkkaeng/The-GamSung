jQuery(document).ready(function() {
    wow = new WOW({
        boxClass:     'wow',      //  스크롤 이벤트를 등록할 클래스 
        animateClass: 'animated', // 기본값 animated => animate.css library 를 적용한다 
        offset:       200,          // data-wow-offset 의 기본값 0 
        mobile:       true,       // 모바일에서 동작할 것인지 
        live:         true        // 새로추가되는 요소 확인하여 동작 
      })
      wow.init();

	/* FIXED 상단 스크롤 */
	/* var s_left = jQuery(window).scrollLeft();
	jQuery('#mheader').css('margin-left',-s_left);
	jQuery(window).scroll(function(){
		s_left = jQuery(window).scrollLeft();
		jQuery('#mheader').css('margin-left',-s_left);
	}); */

    
    /* GNB 스크롤 반응 */
    var last_scrollTop = 0;
	//var mh_height = jQuery('#mheader .mh_sec01').innerHeight();

	var sc = jQuery(window).scrollTop();
    var mh = jQuery('#mheader').height();
    // console.log(mh)
    jQuery('.mh_blank').css('height', mh);

	if( sc > 0 ){
		jQuery('#mheader').addClass('fixed');
		//jQuery('.mh_empty').css('height', mh_height );
		jQuery('#mheader').css('top', -mh);
	}

	jQuery(window).scroll(function(){
		var sc = jQuery(window).scrollTop();
		if( sc > 0 ){
			jQuery('#mheader').addClass('fixed');
			//jQuery('.mh_empty').css('height', mh_height );

			if (sc > last_scrollTop) {
				jQuery('#mheader').css('top', -mh);
			} else {
				jQuery('#mheader').css('top', '0');
			}
		} else {
			jQuery('#mheader').removeClass('fixed')
			jQuery('#mheader').css('top', '0');
		}
		last_scrollTop = sc;
	})


	/* 상단 국가선택 */
	jQuery('#mheader .mh_sec03 .mh_lang li').each(function(){
		var lang = jQuery(this).children('a').text().toUpperCase();
		jQuery(this).children('a').text(lang);

		if( jQuery(this).hasClass('selected') ){
			jQuery('#mheader .mh_sec03 .mh_lang .current span').text(lang);
		}
	})

	/* 상단04 : 검색 */
    let count = 0;
    var countInterval;
    function chkNumber() {
        $('.hot_keyword ul li:nth-child(1)').addClass('active');
        if (count < 7) {
            $('.hot_keyword ul li').removeClass('active');
            $('.hot_keyword ul li:nth-child(' + (++count) + ')').addClass('active');
        } else if (count = 8) {
            $('.hot_keyword ul li').removeClass('active');
            $('.hot_keyword ul li:nth-child(1)').addClass('active');
            count = 1;
        }
    }

	jQuery('.mh_sec03 .mh_search .search').click(function(){
        countInterval = setInterval(chkNumber, 2000); // 검색어 순위 인터벌 시작
		jQuery('.mh_sec04').slideDown('300',function(){
			jQuery(this).addClass('open')
		});
		jQuery('#mheader').addClass('search');
		jQuery('.mh_dimmed').show('300');
        setTimeout(function(){
			document.getElementById("search_form").focus();
		},300);
        $('#mheader').removeClass("active");
        $('.cate-2depth-container, .cate-2depth-container .inner-container').removeClass("active");
	})
	jQuery('.mh_sec03 .mh_search .close').click(function(){
        clearInterval(countInterval);
        count = 0; // 검색어 순위 인터벌 멈춤 & 순서 0으로
        $('.hot_keyword ul li').removeClass('active');
		jQuery('.mh_sec04').slideUp('300',function(){
			jQuery(this).removeClass('open')
		});
		jQuery('#mheader').removeClass('search');
		jQuery('.mh_dimmed').hide('300');
	})



	/* Fixed SNS */
	jQuery('.mf_quick .btn-smallside').click(function(){
		jQuery('.mf_quick').toggleClass('open');
	});

	/* morenvy.com 추천상품, 신상품 순위 */
	jQuery('.best_item_view .item_photo_box .num').each(function(index) {
		jQuery(this).append(index+1);
	});
	
    var currentScrollTop;
    jQuery(window).scroll(function(){
        // 스크롤시 Top 버튼 노출처리
        currentScrollTop = jQuery(this).scrollTop();
        if(currentScrollTop > 200) {
            jQuery('.mf_up').fadeIn();
            jQuery('.mf_quick').css('bottom', '104px');
        } else {
            jQuery('.mf_up').fadeOut();
            jQuery('.mf_quick').css('bottom', '40px');
        }
    });
    $('#topBtn').on('click', function () {
        $('html,body').animate({ scrollTop: 0 }, 400);
    });



	/* 분류 : 카테고리 */
	jQuery('.menuCategory li').each(function(){
		if( jQuery(this).children('ul').length != 0 ){
			jQuery(this).addClass('Child')
		}
		if( jQuery(this).hasClass('selected') && jQuery(this).parent('ul').parent('li').length != 0){
			jQuery(this).parent('ul').prev('div').children('.more').trigger('click');
		}
	})
	jQuery('.menuCategory li.Child > div span.more').click(function(){
		jQuery(this).parent('div').toggleClass('open').next('ul').slideToggle();
	})
	setTimeout(function(){
		jQuery('.menuCategory li.selected').each(function(){
			if( jQuery(this).parent('ul').parent('li').length != 0 ){
				jQuery(this).parents('ul').prev('div').children('.more').trigger('click');
			}
		})
	},300)

	/* 분류 : 추천상품 */	
	var swiper_best = new Swiper('.best_item_view .swiper_widget', {
		slidesPerView: 3,
		spaceBetween: 24,
		watchOverflow: 'true',
		speed:1000,
		scrollbar: {
		  el: ".best_item_view .swiper-scrollbar-widget",
		  dragSize: 384,
		},
	});


	/* Path 현재 카테고리 강조 */
	jQuery('.path li').not('.displaynone').last().addClass('now');


	/* 게시판 */
	jQuery('.xans-board-listpackage .xans-board-list li .contents').each(function(){
		var content = jQuery(this).text();
		jQuery(this).html(content)
	})



	
	cal_percent (); //할인율
	prd_opt();

	jQuery('.more_btn').click(function(){
		setTimeout(function(){
			cal_percent (); //할인율
			prd_opt();
		},500)
	})
	



	/* 브랜드 페이지 */	
	var swiper_history = new Swiper('.swiper_history', {
		slidesPerView: 'auto',
		speed:1000,
        navigation: {
			nextEl: '.swiper-button-next-history',
			prevEl: '.swiper-button-prev-history',
        },
	});
});


/* morenvy.com 할인율 */
function cal_percent () {
	jQuery("[rel='판매가']").each(function(){
		var m_custom = jQuery(this).siblings("[rel='소비자가']").find('.m_item').text().replace(/[^0-9]/g,'');  //소비자가
		var m_price = jQuery(this).find('.m_item').text().replace(/[^0-9]/g,''); // 판매가
		var m_sale = '';
		if (jQuery(this).siblings("[rel='할인판매가']").find('#span_product_price_sale').length != 0 ){
			m_sale =  jQuery(this).siblings("[rel='할인판매가']").find('#span_product_price_sale').html().split('<')[0].replace(/[^0-9]/g,''); //상세페이지 할인판매가
		} else {
			m_sale = jQuery(this).siblings("[rel='할인판매가']").find('.m_item').text().replace(/[^0-9]/g,''); //상품목록 할인판매가
		}
		if( typeof m_sale == "undefined" || m_sale == "" || m_sale == null ) { //할인판매가가 공백일 때
			m_sale = m_price
		}

		/* 할인율 계산 */
		if(jQuery(this).siblings("[rel='할인판매가']").length != 0 && m_price != m_sale){
			//var c_sale = Math.round(  ( m_custom - m_sale ) / m_custom * 100 );  //소비자가와 할인판매가
			var p_sale = Math.round(  ( m_price - m_sale ) / m_price * 100 ); //판매가와 할인판매가

			jQuery(this).parents('li').find('.sale_box').text(p_sale + '%').insertBefore(jQuery(this).siblings("[rel='할인판매가']")); // 상품목록 할인율 출력
			jQuery(this).parents('.xans-product-detail').find('.price_box .sale_box').show().text(p_sale + '%'); // 상세페이지 할인율 출력

			/* 상품목록 */
			jQuery(this).addClass('through');
			jQuery(this).siblings("[rel='소비자가']").hide();
			jQuery(this).siblings("[rel='할인판매가']").addClass('msale');

			/* 상세페이지 */
			jQuery(this).parents('.xans-product-detail').find('.sale').addClass('msale');
			jQuery(this).parents('.xans-product-detail').find('.price').addClass('through');
			jQuery(this).parents('.xans-product-detail').find('.custom').hide();

		} else if (jQuery(this).siblings("[rel='소비자가']").length != 0){
			if (m_custom != m_price){
				var sale_cnt = Math.round(  ( m_custom - m_price ) / m_custom * 100 ); //소비자가와 판매가

				jQuery(this).parents('li').find('.sale_box').text(sale_cnt + '%').insertBefore(this); // 상품목록 할인율 출력
				jQuery(this).parents('.xans-product-detail').find('.price_box .sale_box').show().text(sale_cnt + '%'); // 상세페이지 할인율 출력

				/* 상품목록 */
				jQuery(this).addClass('msale');
				jQuery(this).siblings("[rel='소비자가']").addClass('through');

				/* 상세페이지 */
				jQuery(this).parents('.xans-product-detail').find('.price').addClass('msale');
				jQuery(this).parents('.xans-product-detail').find('.custom').addClass('through');
			} else {
				/* 상품목록 */
				jQuery(this).addClass('msale');
				jQuery(this).siblings("[rel='소비자가']").hide();

				/* 상세페이지 */
				jQuery(this).parents('.xans-product-detail').find('.price').addClass('msale');
				jQuery(this).parents('.xans-product-detail').find('.custom').hide();
			}
		} else {
			/* 상품목록 */
			jQuery(this).addClass('msale');
			
			/* 상세페이지 */
			jQuery(this).parents('.xans-product-detail').find('.price').addClass('msale');
			jQuery(this).parents('.xans-product-detail').find('.custom').hide();
		}
	})

};


function prd_opt () {
	jQuery('.ec-base-product .prdList > li').each(function(){
		/* morenvy.com 상품진열 장바구니 사용안할시 숨김 */
		if (jQuery(".pro_icon .mcart > .ec-admin-icon", this).length == 1) {
		} else {
			jQuery('.pro_icon .mcart', this).hide();
		}
		/* morenvy.com 상품진열 옵션미리보기 사용안할시 숨김 */
		if (jQuery(".pro_icon .moption > a", this).length == 1) {
			jQuery(this).addClass('a')
		} else {
			jQuery('.pro_icon .moption', this).hide();
		}
		/* morenvy.com 상품진열 관심상품 사용안할시 숨김 */
		if (jQuery(".pro_icon .mwish > .ec-product-listwishicon", this).length == 1) {
		} else {
			jQuery('.pro_icon .mwish', this).hide();
		}
	});

	/* 품절 아이콘 텍스트로 대체 */
	jQuery('.soldout_icon').each(function(){
		if( jQuery(this).children().length != 0 ){
			jQuery(this).text('SOLD OUT').addClass('on')
			jQuery(this).siblings('.pro_icon').hide();
		}
	});
}






jQuery(function(jQuery) {
	jQuery.fn.resizeImageMaps = function() {
		var img = this;

		var resizeImageMaps = function() {
			img.each(function() {
				if (typeof(jQuery(this).attr('usemap')) == 'undefined')
					return;
				var that = jQuery(this),
					that = jQuery(this);

				jQuery('<img />').load(function() {
					var attrW = 'width',
						attrH = 'height',
						w = that.attr(attrW),
						h = that.attr(attrH);

					if (!w || !h) {
						var temp = new Image();
						temp.src = that.attr('src');
						if (!w)
							w = temp.width;
						if (!h)
							h = temp.height;
					}


					var wPercent = that.width()/100,
						hPercent = that.height()/100,
						map = that.attr('usemap').replace('#', ''),
						c = 'coords';

					jQuery('map[name="' + map + '"]').find('area').each(function() {
						var aa = jQuery(this);
						if (!aa.data(c))
							aa.data(c, aa.attr(c));

						var coords = aa.data(c).split(','),
							coordsPercent = new Array(coords.length);

						for (var i = 0; i < coordsPercent.length; ++i) {
							if (i % 2 === 0)
								coordsPercent[i] = parseInt(((coords[i]/w)*100)*wPercent);
							else
								coordsPercent[i] = parseInt(((coords[i]/h)*100)*hPercent);
						}
						aa.attr(c, coordsPercent.toString());
					});
				}).attr('src', that.attr('src'));
			});
		};
		jQuery(window).resize(resizeImageMaps).trigger('resize');
		return this;
	};
    
    $('img[usemap]').resizeImageMaps();
});


/* 공용모달 */
$(function(){
    $(".essaModalBtn").click(function(){
        $(".essaModal").fadeIn(200);        
        var imgSrc = $(this).data('imgsrc');
        $(".essaModal .modalBox").html("<img src='" + imgSrc + "'>");
    });
    
    $(".essaModal button").click(function(){
        $(".essaModal").fadeOut('fast');
    });
    
    $(".essaModal").click(function (e) {
        if (e.target.className != "essaModal") {
            return false;
        } else {
            $(".essaModal").fadeOut('fast');
        }
    });
});


/* 202307251000 이런식으로 지금 날짜+시간 구해서 조건문 사용 */

const today = new Date();
var year = today.getFullYear();
var month = ('0' + (today.getMonth() + 1)).slice(-2);
var day = ('0' + today.getDate()).slice(-2);
var hours = ('0' + today.getHours()).slice(-2);
var minutes = ('0' + today.getMinutes()).slice(-2);
var nowString = year + month + day + hours + minutes ;

// console.log(nowString);

// if(nowString > "202307251000") {
//     $('.p').html('지났다')
// } else {
//     $('.p').html('아직 안 지났다')
// }

/* 상품하단 아이콘 클릭 시 페이지 이동 */
// $(document).ready(function(){
//     $('.item_icon_box img').click(function() {
//         if ($(this).attr('alt') == '공식몰단독')
//             location.href = '/goods/goods_search.php?goodsIcon[n][]=icon0055';
//         else if ($(this).attr('alt') == '온라인')
//             location.href = '/goods/goods_search.php?goodsIcon[n][]=icon0052';
//         else if ($(this).attr('alt') == '직영점')
//             location.href = '/goods/goods_search.php?goodsIcon[n][]=icon0051';
//         else if ($(this).attr('alt') == '백화점')
//             location.href = '/goods/goods_search.php?goodsIcon[n][]=icon0034';
//         else if ($(this).attr('alt') == '컨셉스토어')
//             location.href = '/goods/goods_search.php?goodsIcon[n][]=icon0060';
//         else if ($(this).attr('alt') == '부티크스토어')
//             location.href = '/goods/goods_search.php?goodsIcon[n][]=icon0059';
//         else return false;
//     });
// });

$(document).ready(function(){
    $('.item_icon_box img').each(function () {
        if ($(this).attr('alt') == '공식몰단독') 
            $(this).addClass('icon_jsm');
        if ($(this).attr('alt') == '온라인')
            $(this).addClass('icon_online');
        if ($(this).attr('alt') == '직영점')
            $(this).addClass('icon_flag');
        if ($(this).attr('alt') == '백화점')
            $(this).addClass('icon_dpt');
        if ($(this).attr('alt') == '컨셉스토어')
            $(this).addClass('icon_concept');
        if ($(this).attr('alt') == '부티크스토어')
            $(this).addClass('icon_boutique');
    });    
    $('.item_icon_box').each(function () {
        var firstOne = $(this).find($('img:first-child'));
        var online = $(this).find($('img.icon_online'));
        var flag = $(this).find($('img.icon_flag'));
        var dpt = $(this).find($('img.icon_dpt'));
        var concept = $(this).find($('img.icon_concept'));
        $(online).insertBefore($(firstOne));
        $(flag).insertBefore($(firstOne));
        $(dpt).insertBefore($(firstOne));
        $(concept).insertBefore($(firstOne));
    });    
    $('.item_icon_box').each(function () {
        var lastOne = $(this).find($('img:last-child'));
        var boutique = $(this).find($('img.icon_boutique'));
        $(boutique).insertAfter($(lastOne));
    });
    $('.item_icon_box').each(function () {
        var firstOne = $(this).find($('img:first-child'));
        var jsm = $(this).find($('img.icon_jsm'));
        $(jsm).insertBefore($(firstOne));
    });

});


/* 타임세일 기간 구하기 (금요일 12시부터 ~ 월요일 12시까지) */
const todayWeek = today.getDay();
const todayHours = today.getHours();

function timeSalePeriod() {
    return (todayWeek == 5 && todayHours >= 12) || // 금요일 오후 12시 이후
        (todayWeek > 5 || todayWeek == 0) || // 주말
        (todayWeek == 1 && todayHours < 12); // 월요일 오전 12시 이전
}

function clickMoreList(secId) {
    if($("#"+secId +" .item_gallery_type > ul > li").length > 12){
        $('#'+secId).append("<button class='btn_more_goods'>상품 더보기</button>");
    }
    $("#"+secId +" .item_gallery_type > ul > li:nth-of-type(n+13)").css('display','none');
    $("#"+secId).css('padding-bottom','10px');
    $("#"+secId+" .btn_more_goods").click(function(e){
        e.preventDefault();
        $("#"+secId +" .item_gallery_type > ul > li:hidden").slice(0, 12).css('display','inline-block');
        if($("#"+secId +" .item_gallery_type > ul > li:hidden").length == 0){
            $("#"+secId +" .btn_more_goods").fadeOut();
        }
    });

}
function setProductList(secId, cateCd, soldOutFl){
    var params = {
        cateCd: cateCd,
        lineCnt: 4,
        rowCnt: 20,
        soldOutFl : soldOutFl
    };
    $.get('/custom/goods_list.php', params, function(data){
        $('#'+secId).html(data);
        clickMoreList(secId);
    });
}

function createGoodsList(secId, ...keywords) {
    var queryParams = '';
    for (var i = 0; i < keywords.length; i++) {
        if (i > 0) queryParams += '&';
        queryParams += 'goodsNo[' + i + ']=' + keywords[i];
    }

    $.get('/custom/goods_search.php?' + queryParams, function(data){
        document.getElementById(secId).innerHTML = data;
        clickMoreList(secId);
    });
}

$(document).on('click', '.alert_login', function (e) {
    var target = $(this).attr('id');
    e.preventDefault();
    document.location.href = target == undefined ?  "../member/login.php" : "../member/login.php?id=" + target;
    return false;
});


function addzero(num) {
    if (num < 10 && num >= 1) {
        num = "0" + num;

    } else if (num < 1) {
        num = "00"
        }

    return num;
}